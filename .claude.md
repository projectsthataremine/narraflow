# Claude Code Guide for NarraFlow

## Quick Start
When starting a new session, read this file first to understand the project structure and available commands.

## Available Slash Commands

### `/restart-server`
Restarts the Electron dev server cleanly. Kills the existing server, cleans up processes, and starts fresh.
- Use this when: Code changes aren't hot-reloading, or server seems stuck
- What it does: Reads shell ID from `.dev-server-id`, kills it, cleans up processes, starts new server, saves new ID

### `/check-server`
Checks the status of the current dev server.
- Use this when: You want to verify the server is running
- What it does: Reads shell ID from `.dev-server-id`, checks if running, shows recent output

### `/kill-server`
Stops the dev server without starting a new one.
- Use this when: You're done developing and want to stop all processes
- What it does: Reads shell ID from `.dev-server-id`, kills the server, clears the ID file

## Project Structure

```
NarraFlow/
â”œâ”€â”€ electron/          # Main Electron app
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main/     # Main process (Node.js)
â”‚   â”‚   â”œâ”€â”€ ui/       # Renderer processes (React)
â”‚   â”‚   â””â”€â”€ audio/    # Audio processing
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ marketing-site/    # Next.js marketing website
â””â”€â”€ supabase/         # Supabase backend
```

## Key Files to Know

- **`.dev-server-id`** - Tracks the background shell ID of the running dev server (gitignored)
- **`electron/src/ui/overlay/app.tsx`** - Main overlay window (recording pill)
- **`electron/src/main/ipc-handlers.ts`** - IPC communication between main/renderer
- **`electron/src/main/shortcuts.ts`** - Global hotkey handling (Fn key)

## Important Context

### Audio/Microphone Flow
1. **Start**: Fn key pressed â†’ `shortcuts.ts` â†’ `ipc-handlers.ts:startRecordingDirect()` â†’ IPC to renderer
2. **Renderer**: `app.tsx` receives IPC â†’ calls `getUserMedia()` â†’ ğŸŸ  **macOS mic indicator appears**
3. **Stop**: Fn key released â†’ `ipc-handlers.ts:stopRecordingDirect()` â†’ IPC to renderer
4. **Cleanup**: `app.tsx` stops tracks â†’ `track.stop()` â†’ ğŸŸ  **mic indicator should disappear**

Critical fix in `app.tsx:170-202`: Tracks are stopped SYNCHRONOUSLY before async cleanup to ensure mic releases immediately.

### Dev Server Management
- Working directory: `/Users/joshuaarnold/Dev/NarraFlow/electron`
- Command: `npm run dev` (runs vite + tsc + electron concurrently)
- Port: 5173 (Vite dev server)
- Always use `.dev-server-id` to track running server

## Common Tasks

### Restart the App
```
/restart-server
```

### Check Server Status
```
/check-server
```

### Stop Development
```
/kill-server
```

## Tips for Claude

1. **ALWAYS use slash commands for server management** - NEVER use manual Bash commands to start/stop/restart servers
   - âœ… CORRECT: Use `/restart-server`, `/check-server`, `/kill-server`
   - âŒ WRONG: Using `npm run dev`, `pkill`, `KillShell` directly
   - The user wants to see you explicitly calling the slash commands, not running manual operations
2. **Always check `.dev-server-id`** before starting a new server to avoid multiple instances
3. **Reference this file** at the start of each session for context
4. **Working directory** should always be `/Users/joshuaarnold/Dev/NarraFlow/electron` for dev commands
